var G=Object.create;var h=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var _=e=>t=>{var n=e[t];if(n)return n();throw new Error("Module not found in bundle: "+t)};var u=(e,t)=>()=>(e&&(t=e(e=0)),t);var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),E=(e,t)=>{for(var n in t)h(e,n,{get:t[n],enumerable:!0})},Q=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of W(t))!V.call(e,a)&&a!==n&&h(e,a,{get:()=>t[a],enumerable:!(r=H(t,a))||r.enumerable});return e};var v=(e,t,n)=>(n=e!=null?G(B(e)):{},Q(t||!e||!e.__esModule?h(n,"default",{value:e,enumerable:!0}):n,e));var Y={};var k=u(()=>{});var g=z(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.oxmysql=void 0;var b=[];function m(e,t){if(!e)throw new TypeError(t)}var o=(e,t,n,r)=>{if(typeof e=="number"&&(e=b[e]),r?m(typeof e=="object",`First argument expected object, recieved ${typeof e}`):m(typeof e=="string",`First argument expected string, received ${typeof e}`),t){let a=typeof t;m(a==="object"||a==="function",`Second argument expected object or function, received ${a}`),!n&&a==="function"&&(n=t,t=void 0)}return n!==void 0&&m(typeof n=="function",`Third argument expected function, received ${typeof n}`),[e,t,n]},A=global.exports.oxmysql,K=GetCurrentResourceName();function s(e,t,n){return new Promise((r,a)=>{A[e](t,n,(p,l)=>{if(l)return a(l);r(p)},K,!0)})}T.oxmysql={store(e){return m(typeof e!="string",`Query expects a string, received ${typeof e}`),b.push(e)},ready(e){setImmediate(async()=>{for(;GetResourceState("oxmysql")!=="started";)await new Promise(t=>setTimeout(t,50));e()})},async query(e,t,n){[e,t,n]=o(e,t,n);let r=await s("query",e,t);return n?n(r):r},async single(e,t,n){[e,t,n]=o(e,t,n);let r=await s("single",e,t);return n?n(r):r},async scalar(e,t,n){[e,t,n]=o(e,t,n);let r=await s("scalar",e,t);return n?n(r):r},async update(e,t,n){[e,t,n]=o(e,t,n);let r=await s("update",e,t);return n?n(r):r},async insert(e,t,n){[e,t,n]=o(e,t,n);let r=await s("insert",e,t);return n?n(r):r},async prepare(e,t,n){[e,t,n]=o(e,t,n);let r=await s("prepare",e,t);return n?n(r):r},async rawExecute(e,t,n){[e,t,n]=o(e,t,n);let r=await s("rawExecute",e,t);return n?n(r):r},async transaction(e,t,n){[e,t,n]=o(e,t,n,!0);let r=await s("transaction",e,t);return n?n(r):r},isReady(){return A.isReady()},async awaitConnection(){return await A.awaitConnection()}}});function i(e,t,...n){let r;do r=`${e}:${Math.floor(Math.random()*100001)}:${t}`;while(C[r]);return emitNet(`_bl_cb_${e}`,t,N,r,...n),new Promise(a=>{C[r]=a})}function d(e,t){onNet(`_bl_cb_${e}`,async(n,r,...a)=>{let p=source,l;try{l=await t(p,...a)}catch(x){console.error(`an error occurred while handling callback event ${e}`),console.log(`^3${x.stack}^0`)}emitNet(`_bl_cb_${n}`,p,r,l)})}var N,C,X,Z,f,ue,y=u(()=>{N=GetCurrentResourceName(),C={};onNet(`_bl_cb_${N}`,(e,...t)=>{let n=C[e];return n&&n(...t)});X=exports.bl_bridge,Z=X.core(),f=e=>{let t=Z.GetPlayer(e);return t?t.id:null},ue=exports.bl_appearance.config()});async function P(e,t){let n=f(e);return await w.oxmysql.update("UPDATE appearance SET skin = ? WHERE id = ?",[JSON.stringify(t),n])}async function R(e,t){let n=f(e);return await w.oxmysql.update("UPDATE appearance SET clothes = ? WHERE id = ?",[JSON.stringify(t),n])}async function O(e,t){let n=f(e);return await w.oxmysql.update("UPDATE appearance SET tattoos = ? WHERE id = ?",[JSON.stringify(t),n])}async function c(e,t,n){if(e&&t){let x=f(e);if(t!==x){console.warn("You are trying to save an appearance for a different player",e,t);return}}t||(t=f(e));let r={drawables:n.drawables,props:n.props,headOverlay:n.headOverlay},a={headBlend:n.headBlend,headStructure:n.headStructure,hairColor:n.hairColor,model:n.model},p=n.tattoos||[];return await w.oxmysql.prepare("INSERT INTO appearance (id, clothes, skin, tattoos) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE clothes = VALUES(clothes), skin = VALUES(skin), tattoos = VALUES(tattoos);",[t,JSON.stringify(r),JSON.stringify(a),JSON.stringify(p)])}var w,S=u(()=>{y();w=v(g(),1);d("bl_appearance:server:saveSkin",P);exports("SaveSkin",P);d("bl_appearance:server:saveClothes",R);exports("SaveClothes",R);d("bl_appearance:server:saveTattoos",O);exports("SaveTattoos",O);d("bl_appearance:server:saveAppearance",c);exports("SaveAppearance",function(e,t){return c(null,e,t)})});var I={};E(I,{default:()=>te});var $,q,ee,te,U=u(()=>{$=v(g(),1);y();S();q=e=>new Promise(t=>setTimeout(t,e)),ee=async e=>{let t=await $.oxmysql.query("SELECT * FROM `players`");if(t){for(let n of t)if(n.skin){await i("bl_appearance:client:migration:setAppearance",e,{type:"fivem",data:JSON.parse(n.skin)}),await q(100);let r=await i("bl_appearance:client:getAppearance",e),a=parseInt(e);await c(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},te=ee});var J={};E(J,{default:()=>ae});var D,ne,re,ae,L=u(()=>{D=v(g(),1);y();S();ne=e=>new Promise(t=>setTimeout(t,e)),re=async e=>{let t=await D.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1");if(t){for(let n of t)if(n.skin){await i("bl_appearance:client:migration:setAppearance",e,{type:"illenium",data:JSON.parse(n.skin)}),await ne(100);let r=await i("bl_appearance:client:getAppearance",e),a=parseInt(e);await c(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},ae=re});var F={};E(F,{default:()=>ie});var M,oe,se,ie,j=u(()=>{M=v(g(),1);y();S();oe=e=>new Promise(t=>setTimeout(t,e)),se=async e=>{let t=await M.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1");if(t){for(let n of t){emitNet("qb-clothes:loadSkin",e,0,n.model,n.skin),await oe(200);let r=await i("bl_appearance:client:getAppearance",e),a=parseInt(e);await c(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},ie=se});var ce=_({"./migrate/esx.ts":()=>Promise.resolve().then(()=>(k(),Y)),"./migrate/fivem.ts":()=>Promise.resolve().then(()=>(U(),I)),"./migrate/illenium.ts":()=>Promise.resolve().then(()=>(L(),J)),"./migrate/qb.ts":()=>Promise.resolve().then(()=>(j(),F))});onNet("bl_appearance:server:setroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),source)});onNet("bl_appearance:server:resetroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),0)});RegisterCommand("migrate",async e=>{e=e!==0?e:parseInt(getPlayers()[0]);let n=exports.bl_appearance.config();(await ce(`./migrate/${n.previousClothing==="fivem-appearance"?"fivem":n.previousClothing}.ts`)).default(e)},!1);
