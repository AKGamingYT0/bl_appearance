var ae=Object.create;var C=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var R=e=>t=>{var n=e[t];if(n)return n();throw new Error("Module not found in bundle: "+t)};var y=(e,t)=>()=>(e&&(t=e(e=0)),t);var ce=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),A=(e,t)=>{for(var n in t)C(e,n,{get:t[n],enumerable:!0})},le=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ie(t))!pe.call(e,a)&&a!==n&&C(e,a,{get:()=>t[a],enumerable:!(r=oe(t,a))||r.enumerable});return e};var b=(e,t,n)=>(n=e!=null?ae(se(e)):{},le(t||!e||!e.__esModule?C(n,"default",{value:e,enumerable:!0}):n,e));var m=ce(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.oxmysql=void 0;var N=[];function S(e,t){if(!e)throw new TypeError(t)}var p=(e,t,n,r)=>{if(typeof e=="number"&&(e=N[e]),r?S(typeof e=="object",`First argument expected object, recieved ${typeof e}`):S(typeof e=="string",`First argument expected string, received ${typeof e}`),t){let a=typeof t;S(a==="object"||a==="function",`Second argument expected object or function, received ${a}`),!n&&a==="function"&&(n=t,t=void 0)}return n!==void 0&&S(typeof n=="function",`Third argument expected function, received ${typeof n}`),[e,t,n]},h=global.exports.oxmysql,ue=GetCurrentResourceName();function c(e,t,n){return new Promise((r,a)=>{h[e](t,n,(s,d)=>{if(d)return a(d);r(s)},ue,!0)})}v.oxmysql={store(e){return S(typeof e!="string",`Query expects a string, received ${typeof e}`),N.push(e)},ready(e){setImmediate(async()=>{for(;GetResourceState("oxmysql")!=="started";)await new Promise(t=>setTimeout(t,50));e()})},async query(e,t,n){[e,t,n]=p(e,t,n);let r=await c("query",e,t);return n?n(r):r},async single(e,t,n){[e,t,n]=p(e,t,n);let r=await c("single",e,t);return n?n(r):r},async scalar(e,t,n){[e,t,n]=p(e,t,n);let r=await c("scalar",e,t);return n?n(r):r},async update(e,t,n){[e,t,n]=p(e,t,n);let r=await c("update",e,t);return n?n(r):r},async insert(e,t,n){[e,t,n]=p(e,t,n);let r=await c("insert",e,t);return n?n(r):r},async prepare(e,t,n){[e,t,n]=p(e,t,n);let r=await c("prepare",e,t);return n?n(r):r},async rawExecute(e,t,n){[e,t,n]=p(e,t,n);let r=await c("rawExecute",e,t);return n?n(r):r},async transaction(e,t,n){[e,t,n]=p(e,t,n,!0);let r=await c("transaction",e,t);return n?n(r):r},isReady(){return h.isReady()},async awaitConnection(){return await h.awaitConnection()}}});function l(e,t,...n){let r;do r=`${e}:${Math.floor(Math.random()*100001)}:${t}`;while(k[r]);return emitNet(`_bl_cb_${e}`,t,P,r,...n),new Promise(a=>{k[r]=a})}function o(e,t){onNet(`_bl_cb_${e}`,async(n,r,...a)=>{let s=source,d;try{d=await t(s,...a)}catch(x){console.error(`an error occurred while handling callback event ${e}`),console.log(`^3${x.stack}^0`)}emitNet(`_bl_cb_${n}`,s,r,d)})}var P,k,fe,E,j,i,me,I,g=y(()=>{P=GetCurrentResourceName(),k={};onNet(`_bl_cb_${P}`,(e,...t)=>{let n=k[e];return n&&n(...t)});fe=exports.bl_bridge,E=fe.core(),j=e=>E.GetPlayer(e),i=e=>{let t=E.GetPlayer(e);return t?t.id:null},me=exports.bl_appearance.config(),I=me});async function H(e,t){let n=i(e);return await w.oxmysql.update("UPDATE appearance SET skin = ? WHERE id = ?",[JSON.stringify(t),n])}async function W(e,t){let n=i(e);return await w.oxmysql.update("UPDATE appearance SET clothes = ? WHERE id = ?",[JSON.stringify(t),n])}async function U(e,t){let n=i(e);return await w.oxmysql.update("UPDATE appearance SET tattoos = ? WHERE id = ?",[JSON.stringify(t),n])}async function f(e,t,n){if(e&&t){let x=i(e);if(t!==x){console.warn("You are trying to save an appearance for a different player",e,t);return}}t||(t=i(e));let r={drawables:n.drawables,props:n.props,headOverlay:n.headOverlay},a={headBlend:n.headBlend,headStructure:n.headStructure,hairColor:n.hairColor,model:n.model},s=n.tattoos||[];return await w.oxmysql.prepare("INSERT INTO appearance (id, clothes, skin, tattoos) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE clothes = VALUES(clothes), skin = VALUES(skin), tattoos = VALUES(tattoos);",[t,JSON.stringify(r),JSON.stringify(a),JSON.stringify(s)])}var w,O=y(()=>{g();w=b(m(),1);o("bl_appearance:server:saveSkin",H);exports("SaveSkin",H);o("bl_appearance:server:saveClothes",W);exports("SaveClothes",W);o("bl_appearance:server:saveTattoos",U);exports("SaveTattoos",U);o("bl_appearance:server:saveAppearance",f);exports("SaveAppearance",function(e,t){return f(null,e,t)})});var ge={};var Q=y(()=>{});var K={};A(K,{default:()=>be});var Y,de,ye,be,X=y(()=>{Y=b(m(),1);g();O();de=e=>new Promise(t=>setTimeout(t,e)),ye=async e=>{let t=await Y.oxmysql.query("SELECT * FROM `players`");if(t){for(let n of t)if(n.skin){await l("bl_appearance:client:migration:setAppearance",e,{type:"fivem",data:JSON.parse(n.skin)}),await de(100);let r=await l("bl_appearance:client:getAppearance",e),a=parseInt(e);await f(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},be=ye});var q={};A(q,{default:()=>we});var Z,Ee,Se,we,ee=y(()=>{Z=b(m(),1);g();O();Ee=e=>new Promise(t=>setTimeout(t,e)),Se=async e=>{let t=await Z.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1");if(t){for(let n of t)if(n.skin){await l("bl_appearance:client:migration:setAppearance",e,{type:"illenium",data:JSON.parse(n.skin)}),await Ee(100);let r=await l("bl_appearance:client:getAppearance",e),a=parseInt(e);await f(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},we=Se});var ne={};A(ne,{default:()=>ve});var te,Oe,Te,ve,re=y(()=>{te=b(m(),1);g();O();Oe=e=>new Promise(t=>setTimeout(t,e)),Te=async e=>{let t=await te.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1");if(t){for(let n of t){emitNet("qb-clothes:loadSkin",e,0,n.model,n.skin),await Oe(200);let r=await l("bl_appearance:client:getAppearance",e),a=parseInt(e);await f(a,n.citizenid,r)}console.log("Converted "+t.length+" appearances")}},ve=Te});var u=b(m(),1);g();async function D(e,t){let n=E.GetPlayer(e).job||{name:"unknown",grade:{name:"unknown"}},r=await u.oxmysql.prepare("SELECT * FROM outfits WHERE player_id = ? OR (jobname = ? AND jobrank <= ?)",[t,n.name,n.grade.name]);return r?(Array.isArray(r)||(r=[r]),r.map(s=>({id:s.id,label:s.label,outfit:JSON.parse(s.outfit),jobname:s.jobname}))):[]}o("bl_appearance:server:getOutfits",D);exports("GetOutfits",D);async function L(e,t){let n=i(e);return await u.oxmysql.update("UPDATE outfits SET label = ? WHERE player_id = ? AND id = ?",[t.label,n,t.id])}o("bl_appearance:server:renameOutfit",L);exports("RenameOutfit",L);async function F(e,t){let n=i(e);return await u.oxmysql.update("DELETE FROM outfits WHERE player_id = ? AND id = ?",[n,t])>0}o("bl_appearance:server:deleteOutfit",F);exports("DeleteOutfit",F);async function J(e,t){let n=i(e),r=null,a=0;return t.job&&(r=t.job.name,a=t.job.rank),await u.oxmysql.insert("INSERT INTO outfits (player_id, label, outfit, jobname, jobrank) VALUES (?, ?, ?, ?, ?)",[n,t.label,JSON.stringify(t.outfit),r,a])}o("bl_appearance:server:saveOutfit",J);exports("SaveOutfit",J);async function M(e,t){let n=await u.oxmysql.prepare("SELECT outfit FROM outfits WHERE id = ?",[t]);return JSON.parse(n)}o("bl_appearance:server:fetchOutfit",M);exports("FetchOutfit",M);async function $(e,t,n,r){let a=await u.oxmysql.query("SELECT label, outfit FROM outfits WHERE id = ?",[n]);return!a||typeof a!="object"||Object.keys(a).length===0?{success:!1,message:"Outfit not found"}:{success:!0,newId:await u.oxmysql.insert("INSERT INTO outfits (player_id, label, outfit) VALUES (?, ?, ?)",[t,r,a.outfit])}}o("bl_appearance:server:importOutfit",$);exports("ImportOutfit",$);var _=I.outfitItem;_||console.warn("bl_appearance: No outfit item configured, please set it in config.lua");o("bl_appearance:server:itemOutfit",async(e,t)=>{E.GetPlayer(e).addItem(_,1,t)});E.RegisterUsableItem(_,async(e,t,n)=>{j(e)?.removeItem(_,1,t)&&emitNet("bl_appearance:server:useOutfitItem",e,n.outfit)});O();var T=b(m(),1);g();async function G(e,t){t||(t=i(e));let n=await T.oxmysql.prepare("SELECT skin FROM appearance WHERE id = ?",[t]);return JSON.parse(n)}o("bl_appearance:server:getSkin",G);exports("GetSkin",function(e){return G(null,e)});async function B(e,t){t||(t=i(e));let n=await T.oxmysql.prepare("SELECT clothes FROM appearance WHERE id = ?",[t]);return JSON.parse(n)}o("bl_appearance:server:getClothes",B);exports("GetClothes",function(e){return B(null,e)});async function V(e,t){t||(t=i(e));let n=await T.oxmysql.prepare("SELECT tattoos FROM appearance WHERE id = ?",[t]);return JSON.parse(n)||[]}o("bl_appearance:server:getTattoos",V);exports("GetTattoos",function(e){return V(null,e)});async function z(e,t){if(!t&&!e)return null;t||(t=i(e));let n=await T.oxmysql.single("SELECT * FROM appearance WHERE id = ? LIMIT 1",[t]);if(!n)return null;let r={...JSON.parse(n.skin),...JSON.parse(n.clothes),tattoos:JSON.parse(n.tattoos)};return r.id=n.id,r}o("bl_appearance:server:getAppearance",z);exports("GetAppearance",function(e){return z(null,e)});var _e=R({"./migrate/esx.ts":()=>Promise.resolve().then(()=>(Q(),ge)),"./migrate/fivem.ts":()=>Promise.resolve().then(()=>(X(),K)),"./migrate/illenium.ts":()=>Promise.resolve().then(()=>(ee(),q)),"./migrate/qb.ts":()=>Promise.resolve().then(()=>(re(),ne))});onNet("bl_appearance:server:setroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),source)});onNet("bl_appearance:server:resetroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),0)});RegisterCommand("migrate",async e=>{e=e!==0?e:parseInt(getPlayers()[0]);let n=exports.bl_appearance.config();(await _e(`./migrate/${n.previousClothing==="fivem-appearance"?"fivem":n.previousClothing}.ts`)).default(e)},!1);
