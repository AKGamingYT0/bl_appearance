var s=0,F=e=>{s=e};var G=(e,t)=>{SendNUIMessage({action:e,data:t})},N=e=>new Promise(t=>setTimeout(t,e)),ue=async e=>{let t=typeof e=="number"?e:GetHashKey(e);if(!IsModelValid(t))throw exports.bl_bridge.notify()({title:"Invalid model!",type:"error",duration:1e3}),new Error(`attempted to load invalid model '${e}'`);return HasModelLoaded(t)||(RequestModel(t),await new Promise(a=>{let o=setInterval(()=>{HasModelLoaded(t)&&(clearInterval(o),a())},100)})),t},M=GetCurrentResourceName(),ce={},j={};function Me(e,t){if(t&&t>0){let r=GetGameTimer();if((ce[e]||0)>r)return!1;ce[e]=r+t}return!0}onNet(`__ox_cb_${M}`,(e,...t)=>{let r=j[e];return r&&r(...t)});function d(e,...t){if(!Me(e,0))return;let r;do r=`${e}:${Math.floor(Math.random()*100001)}`;while(j[r]);return emitNet(`__ox_cb_${e}`,M,r,...t),new Promise(a=>{j[r]=a})}function z(e,t){onNet(`__ox_cb_${e}`,async(r,a,...o)=>{let n;try{n=await t(...o)}catch(i){console.error(`an error occurred while handling callback event ${e}`),console.log(`^3${i.stack}^0`)}emitNet(`__ox_cb_${r}`,a,n)})}var pe=e=>new Promise(t=>{let r=()=>{if(RequestResourceFileSet(e)){let a=exports.bl_appearance.config().locale,o=LoadResourceFile(M,`locale/${a}.json`);o||(console.error(`${a}.json not found in locale, please verify!, we used english for now!`),o=LoadResourceFile(M,"locale/en.json")),t(o)}else setTimeout(r,100)};r()});var I=exports.bl_bridge,Z=()=>I.core().getPlayerData(),g=()=>Z().cid;function de(e){return new Promise(t=>setTimeout(t,e))}var S=!1,f=1.8,b=null,y=0,_=0,h=null,K=null,W=!1,me=0,fe="head",Ge={head:31086,torso:24818,legs:14201},T=e=>Math.cos(e*Math.PI/180),$=e=>Math.sin(e*Math.PI/180),ge=()=>{let e=(T(_)*T(y)+T(y)*T(_))/2*f,t=($(_)*T(y)+T(y)*$(_))/2*f,r=$(y)*f;return[e,t,r]},Ne=(e,t)=>{if(!S||!h||W)return;e=e??0,t=t??0,_-=e,y+=t,y=Math.min(Math.max(y,0),89);let[r,a,o]=ge();SetCamCoord(b,h.x+r,h.y+a,h.z+o),PointCamAtCoord(b,h.x,h.y,h.z)},be=async(e,t)=>{let r=GetEntityHeading(s)+94;t=t??1,W=!0,f=t,_=r;let[a,o,n]=ge(),i=CreateCamWithParams("DEFAULT_SCRIPTED_CAMERA",e.x+a,e.y+o,e.z+n,0,0,0,70,!1,0);h=e,W=!1,K=b,b=i,PointCamAtCoord(i,e.x,e.y,e.z),SetCamActiveWithInterp(i,K,250,0,0),await N(250),SetCamUseShallowDofMode(i,!0),SetCamNearDof(i,.4),SetCamFarDof(i,1.2),SetCamDofStrength(i,.3),he(i),DestroyCam(K,!0)},he=e=>{DoesCamExist(b)&&e==b&&(SetUseHiDof(),setTimeout(he,0))},ye=()=>{if(S)return;S=!0,f=1,b=CreateCam("DEFAULT_SCRIPTED_CAMERA",!0);let[e,t,r]=GetPedBoneCoords(s,31086,0,0,0);SetCamCoord(b,e,t,r),RenderScriptCams(!0,!0,1e3,!0,!0),be({x:e,y:t,z:r},f)},xe=()=>{S&&(S=!1,RenderScriptCams(!1,!0,250,!0,!1),DestroyCam(b,!0),b=null,h=null)},U=e=>{let t=Ge[e];if(fe==e)return;let[r,a,o]=t?GetPedBoneCoords(s,t,0,0,t===14201?.2:0):GetEntityCoords(s,!1);be({x:r,y:a,z:o+0},1),fe=e};RegisterNuiCallback("appearance:camMove",(e,t)=>{t(1);let r=GetEntityHeading(s);me!=e.x&&(r=e.x>me?r+5:r-5,SetEntityHeading(s,r))});RegisterNuiCallback("appearance:camScroll",(e,t)=>{switch(e){case 2:U();break;case 1:U("legs");break;case 3:U("head");break}t(1)});RegisterNuiCallback("appearance:camZoom",(e,t)=>{if(e==="down"){let r=f+.05;f=r>=1?1:r}else if(e==="up"){let r=f-.05;f=r<=.35?.35:r}f=f,Ne(),t(1)});var q=["Blemishes","FacialHair","Eyebrows","Ageing","Makeup","Blush","Complexion","SunDamage","Lipstick","MolesFreckles","ChestHair","BodyBlemishes","AddBodyBlemishes","EyeColor"];var J=["Nose_Width","Nose_Peak_Height","Nose_Peak_Lenght","Nose_Bone_Height","Nose_Peak_Lowering","Nose_Bone_Twist","EyeBrown_Height","EyeBrown_Forward","Cheeks_Bone_High","Cheeks_Bone_Width","Cheeks_Width","Eyes_Openning","Lips_Thickness","Jaw_Bone_Width","Jaw_Bone_Back_Lenght","Chin_Bone_Lowering","Chin_Bone_Length","Chin_Bone_Width","Chin_Hole","Neck_Thikness"];var X=["face","masks","hair","torsos","legs","bags","shoes","neck","shirts","vest","decals","jackets"];var Q=["hats","glasses","earrings","mouth","lhand","rhand","watches","bracelets"];function Ie(e){return exports.bl_appearance.models().findIndex(a=>GetHashKey(a)===e)}function Pe(e){return{color:GetPedHairColor(e),highlight:GetPedHairHighlightColor(e)}}function Ce(e){let t=new ArrayBuffer(80);global.Citizen.invokeNative("0x2746bd9d88c5c5d0",e,new Uint32Array(t));let{0:r,2:a,4:o,6:n,8:i,18:c,10:u}=new Uint32Array(t),{0:l,2:p,4:m}=new Float32Array(t,48);return{shapeFirst:r,shapeSecond:a,shapeThird:o,skinFirst:n,skinSecond:i,skinThird:u,shapeMix:l,thirdMix:m,skinMix:p,hasParent:!!c}}function we(e){let t={},r={};for(let a=0;a<q.length;a++){let o=q[a];if(t[o]=GetNumHeadOverlayValues(a),o==="EyeColor")r[o]={id:o,index:a,overlayValue:GetPedEyeColor(e)};else{let[n,i,c,u,l,p]=GetPedHeadOverlayData(e,a+1);r[o]={id:o,index:a,overlayValue:i===255?-1:i,colourType:c,firstColor:u,secondColor:l,overlayOpacity:p}}}return[r,t]}function Te(e){let t=GetEntityModel(e);if(t!==GetHashKey("mp_m_freemode_01")&&t!==GetHashKey("mp_f_freemode_01"))return;let r={};for(let a=0;a<J.length;a++){let o=J[a];r[o]={id:o,index:a,value:GetPedFaceFeature(e,a)}}return r}function _e(e){let t={},r={};for(let a=0;a<X.length;a++){let o=X[a],n=GetPedDrawableVariation(e,a);r[o]={id:o,index:a,total:GetNumberOfPedDrawableVariations(e,a),textures:GetNumberOfPedTextureVariations(e,a,n)},t[o]={id:o,index:a,value:GetPedDrawableVariation(e,a),texture:GetPedTextureVariation(e,a)}}return[t,r]}function ke(e){let t={},r={};for(let a=0;a<Q.length;a++){let o=Q[a],n=GetPedPropIndex(e,a);r[o]={id:o,index:a,total:GetNumberOfPedPropDrawableVariations(e,a),textures:GetNumberOfPedPropTextureVariations(e,a,n)},t[o]={id:o,index:a,value:GetPedPropIndex(e,a),texture:GetPedPropTextureIndex(e,a)}}return[t,r]}async function P(e){let[t,r]=we(e),[a,o]=_e(e),[n,i]=ke(e),c=GetEntityModel(e);return{modelIndex:Ie(c),model:c,hairColor:Pe(e),headBlend:Ce(e),headOverlay:t,headOverlayTotal:r,headStructure:Te(e),drawables:a,props:n,drawTotal:o,propTotal:i,tattoos:[]}}exports("GetAppearance",P);z("bl_appearance:client:getAppearance",()=>P(s));function Ee(e){let[t]=_e(e),[r]=ke(e),[a]=we(e);return{headOverlay:a,drawables:t,props:r}}exports("GetPedClothes",Ee);function Be(e){return{headBlend:Ce(e),headStructure:Te(e),hairColor:Pe(e),model:GetEntityModel(e)}}exports("GetPedSkin",Be);function E(){let e=[],[t,r]=exports.bl_appearance.tattoos();for(let o=0;o<r.length;o++){let n=r[o],i=n.zone,c=n.label,u=n.index;e[u]={zone:i,label:c,zoneIndex:u,dlcs:[]};for(let l=0;l<t.length;l++){let p=t[l];e[u].dlcs.push({label:p.dlc,dlcIndex:l,tattoos:[]})}}let a=GetEntityModel(s)===GetHashKey("mp_f_freemode_01");for(let o=0;o<t.length;o++){let n=t[o],{dlc:i,tattoos:c}=n,u=GetHashKey(i);for(let l=0;l<c.length;l++){let p=c[l],m=null,A=p.toLowerCase().includes("_f");(A&&a||!A&&!a)&&(m=p);let x=null,w=-1;m&&(x=GetHashKey(m),w=GetPedDecorationZoneFromHashes(u,x)),w!==-1&&x&&e[w].dlcs[o].tattoos.push({label:m,hash:x,zone:w,dlc:i})}}return e}z("bl_appearance:client:migration:setAppearance",e=>{e.type==="fivem"&&exports["fivem-appearance"].setPlayerAppearance(e.data),e.type==="illenium"&&exports["illenium-appearance"].setPlayerAppearance(e.data)});var B={hats:{type:"prop",index:0},glasses:{type:"prop",index:1},masks:{type:"drawable",index:1,off:0},shirts:{type:"drawable",index:8,off:15,hook:{drawables:[{component:3,variant:15,texture:0,id:"torsos"},{component:11,variant:15,texture:0,id:"jackets"}]}},jackets:{type:"drawable",index:11,off:15,hook:{drawables:[{component:3,variant:15,texture:0,id:"torsos"},{component:8,variant:15,texture:0,id:"shirts"}]}},legs:{type:"drawable",index:4,off:11},shoes:{type:"drawable",index:6,off:13}};function O(e,t){return SetPedComponentVariation(e,t.index,t.value,t.texture,0),GetNumberOfPedTextureVariations(e,t.index,t.value)}function H(e,t){if(t.value===-1){ClearPedProp(e,t.index);return}return SetPedPropIndex(e,t.index,t.value,t.texture,!1),GetNumberOfPedPropTextureVariations(e,t.index,t.value)}var Y=async e=>{let t=await ue(e);SetPlayerModel(PlayerId(),t),SetModelAsNoLongerNeeded(t);let r=PlayerPedId();F(r),SetPedDefaultComponentVariation(r),t===GetHashKey("mp_m_freemode_01")?SetPedHeadBlendData(s,0,0,0,0,0,0,0,0,0,!1):t===GetHashKey("mp_f_freemode_01")&&SetPedHeadBlendData(s,45,21,0,20,15,0,.3,.1,0,!1)};function ee(e,t){SetPedFaceFeature(e,t.index,t.value+0)}var k=e=>e>=0?e:0;function te(e,t){let r=k(t.shapeFirst),a=k(t.shapeSecond),o=k(t.shapeThird),n=k(t.skinFirst),i=k(t.skinSecond),c=k(t.skinThird),u=t.shapeMix+0,l=t.skinMix+0,p=t.thirdMix+0,m=t.hasParent;SetPedHeadBlendData(e,r,a,o,n,i,c,u,l,p,m)}function re(e,t){let r=t.index;if(r===13){SetPedEyeColor(e,t.value);return}let a=t.overlayValue===-1?255:t.overlayValue;if(t.id==="hairColor"){SetPedHairTint(e,t.hairColor,t.hairHighlight);return}SetPedHeadOverlay(e,r,a,t.overlayOpacity+0),SetPedHeadOverlayColor(e,r,1,t.firstColor,t.secondColor)}function ve(e){let t=e.drawables,r=e.props;for(let[a,o]of Object.entries(B)){let n=o.type,i=o.index;n==="drawable"&&t[a]?GetPedDrawableVariation(s,i)!==t[a].value&&SetPedComponentVariation(s,i,t[a].value,0,0):n==="prop"&&r[a]&&GetPedPropIndex(s,i)!==r[a].value&&SetPedPropIndex(s,i,r[a].value,0,!1)}}function D(e,t){let r=t.drawables,a=t.props,o=t.headOverlay;for(let n in r){let i=r[n];O(e,i)}for(let n in a){let i=a[n];H(e,i)}for(let n in o){let i=o[n];re(e,i)}}var ae=async e=>{let t=e.headStructure,r=e.headBlend;if(await Y(e.model),r&&te(s,r),t)for(let a in t){let o=t[a];ee(s,o)}};function C(e,t){if(t){ClearPedDecorationsLeaveScars(e);for(let r=0;r<t.length;r++){let a=t[r].tattoo;if(a){let o=GetHashKey(a.dlc),n=a.hash;AddPedDecorationFromHashes(e,o,n)}}}}function oe(e,t){let r=t.color,a=t.highlight;SetPedHairColor(e,r,a)}async function Se(e,t){await ae(t),D(e,t),oe(e,t.hairColor),C(e,t.tattoos)}async function v(e){await ae(e),D(s,e),oe(s,e.hairColor),C(s,e.tattoos)}exports("SetPedClothes",D);exports("SetPedSkin",ae);exports("SetPedTattoos",C);exports("SetPedHairColors",oe);RegisterNuiCallback("appearance:cancel",async(e,t)=>{await v(e),ne(),t(1)});RegisterNuiCallback("appearance:save",async(e,t)=>{ve(e),await N(100);let r=await P(s);r.tattoos=e.tattoos,d("bl_appearance:server:saveAppearance",g(),r),C(s,r.tattoos),ne(),t(1)});RegisterNuiCallback("appearance:setModel",async(e,t)=>{let r=GetHashKey(e);if(!IsModelInCdimage(r)||!IsModelValid(r))return t(0);await Y(r);let a=await P(s);a.tattoos=[],C(s,[]),t(a)});RegisterNuiCallback("appearance:getModelTattoos",async(e,t)=>{let r=E();t(r)});RegisterNuiCallback("appearance:setHeadStructure",async(e,t)=>{ee(s,e),t(1)});RegisterNuiCallback("appearance:setHeadOverlay",async(e,t)=>{re(s,e),t(1)});RegisterNuiCallback("appearance:setHeadBlend",async(e,t)=>{te(s,e),t(1)});RegisterNuiCallback("appearance:setTattoos",async(e,t)=>{C(s,e),t(1)});RegisterNuiCallback("appearance:setProp",async(e,t)=>{let r=H(s,e);t(r)});RegisterNuiCallback("appearance:setDrawable",async(e,t)=>{let r=O(s,e);t(r)});RegisterNuiCallback("appearance:toggleItem",async(e,t)=>{let r=B[e.item];if(!r)return t(!1);let a=e.data,o=r.type,n=r.index,i=r.hook,c=e.hookData;if(!a)return t(!1);if(o==="prop")if(GetPedPropIndex(s,n)===-1){H(s,a),t(!1);return}else{ClearPedProp(s,n),t(!0);return}else if(o==="drawable"){let u=GetPedDrawableVariation(s,n);if(a.value===r.off){t(!1);return}if(a.value===u){if(SetPedComponentVariation(s,n,r.off,0,0),i)for(let l=0;l<i.drawables?.length;l++){let p=i.drawables[l];SetPedComponentVariation(s,p.component,p.variant,p.texture,0)}t(!0);return}else{O(s,a);for(let l=0;l<c?.length;l++)O(s,c[l]);t(!1);return}}});RegisterNuiCallback("appearance:saveOutfit",async(e,t)=>{let r=g(),a=await d("bl_appearance:server:saveOutfit",r,e);t(a)});RegisterNuiCallback("appearance:deleteOutfit",async({id:e},t)=>{let r=g(),a=await d("bl_appearance:server:deleteOutfit",r,e);t(a)});RegisterNuiCallback("appearance:renameOutfit",async(e,t)=>{let r=g(),a=await d("bl_appearance:server:renameOutfit",r,e);t(a)});RegisterNuiCallback("appearance:useOutfit",async(e,t)=>{D(s,e),t(1)});RegisterNuiCallback("appearance:importOutfit",async({id:e},t)=>{let r=g(),a=await d("bl_appearance:server:importOutfit",r,e);t(a)});RegisterNuiCallback("appearance:grabOutfit",async({id:e},t)=>{let r=await d("bl_appearance:server:grabOutfit",e);t(r)});var se=exports.bl_appearance,Oe=0,ie=!1,L=null,V=null;async function R(e,t=!1){if(e===null||ie)return;let r=PlayerPedId(),a=se.menus(),o=e.type,n=a[o];if(!n)return;F(r),ye();let i=g(),c=n.tabs,u=n.allowExit;Oe=GetPedArmour(r);let l=[];c.includes("outfits")&&(l=await d("bl_appearance:server:getOutfits",i));let m=[];c.includes("heritage")&&(m=se.models());let A=c.includes("tattoos"),x;A&&(x=E());let w=He(e),le=await P(r);return t&&(emitNet("bl_appearance:server:setroutingbucket"),V=new Promise(Ae=>{L=Ae})),G("appearance:data",{tabs:c,appearance:le,blacklist:w,tattoos:x,outfits:l,models:m,allowExit:u,locale:await pe("locale")}),SetNuiFocus(!0,!0),G("appearance:visible",!0),ie=!0,V&&(await V,emitNet("bl_appearance:server:resetroutingbucket")),V=null,L=null,!0}exports("openMenu",R);function He(e){if(!e)return{};let{groupTypes:t,base:r}=se.blacklist();if(!t)return{};if(!r)return{};let a={...r},o=Z();for(let n in t){let i=t[n];for(let c in i){let u=!1;if(n=="jobs"&&e.jobs&&(u=e.jobs.includes(o.job.name)),n=="gangs"&&e.gangs&&(u=e.gangs.includes(o.gang.name)),!u){let l=i[c];a=Object.assign({},a,l,{drawables:Object.assign({},a.drawables,l.drawables)})}}}return a}function ne(){SetPedArmour(s,Oe),xe(),SetNuiFocus(!1,!1),G("appearance:visible",!1),L&&L(),ie=!1}RegisterCommand("openMenu",async()=>{exports.bl_appearance.InitialCreation()},!1);exports("SetPedAppearance",async(e,t)=>{await Se(e,t)});exports("SetPlayerPedAppearance",async e=>{let t=await d("bl_appearance:server:getAppearance",e);await v(t)});exports("GetPlayerPedAppearance",async e=>await d("bl_appearance:server:getAppearance",e));exports("InitialCreation",async e=>{await R({type:"appearance",coords:[0,0,0,0]},!0),e&&e()});on("bl_sprites:client:useZone",e=>{R(e)});onNet("bl_bridge:client:playerLoaded",async()=>{for(;!I.core().playerLoaded();)await de(100);let e=await g(),t=await d("bl_appearance:server:getAppearance",e);await v(t)});onNet("onResourceStart",async e=>{if(e===GetCurrentResourceName()&&I.core().playerLoaded()){let t=await g(),r=await d("bl_appearance:server:getAppearance",t);await v(r)}});
